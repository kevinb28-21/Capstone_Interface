Netlify Deployment Guide

This guide covers deploying your React frontend to Netlify and connecting it to your backend services.

Architecture Overview

Since Netlify is primarily for frontend/static sites, here's the recommended setup:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Netlify        â”‚ â†’ React Frontend (Static)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Railwayâ”‚ â”‚Railwayâ”‚  â”‚   AWS S3   â”‚
â”‚Backendâ”‚ â”‚Flask  â”‚  â”‚  Storage   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend: Netlify (free tier)  
Backend: Railway/Render ($5/month)  
Python API: Railway/Render (same account)  
Database: Railway PostgreSQL (included)  
Storage: AWS S3 (already configured)

Step 1: Prepare Frontend for Netlify

1.1 Update Vite Config for Production

Update client/vite.config.js to handle API URLs:

import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5180,
    proxy: {
      '/api': 'http://localhost:5050',
      '/uploads': 'http://localhost:5050'
    }
  },
  // Production build settings
  build: {
    outDir: 'dist',
    sourcemap: false
  },
  // Define environment variables
  define: {
    'import.meta.env.VITEAPIURL': JSON.stringify(
      process.env.VITEAPIURL || 'http://localhost:5050'
    )
  }
});

1.2 Create API Utility

Create client/src/utils/api.js:

const APIURL = import.meta.env.VITEAPIURL || 'http://localhost:5050';

export const api = {
  get: async (endpoint) => {
    const response = await fetch(${APIURL}${endpoint});
    return response.json();
  },
  post: async (endpoint, data) => {
    const response = await fetch(${APIURL}${endpoint}, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });
    return response.json();
  },
  upload: async (endpoint, formData) => {
    const response = await fetch(${APIURL}${endpoint}, {
      method: 'POST',
      body: formData,
    });
    return response.json();
  },
};

1.3 Update API Calls in Components

Update components to use the API utility instead of relative paths:

Example in client/src/pages/Analytics.jsx:
import { api } from '../utils/api';

const apiCalls = {
  listImages: async () => api.get('/api/images'),
  // ... other calls
};

Step 2: Deploy Backend First

Before deploying frontend, deploy your backend to Railway or Render:

Option A: Railway (Recommended)
  Go to railway.app
  New Project â†’ Deploy from GitHub
  Select server directory
  Add PostgreSQL database
  Set environment variables (see below)
  Deploy

You'll get: https://your-backend.railway.app

Option B: Render
  Go to render.com
  New Web Service
  Connect GitHub â†’ Select server directory
  Set build/start commands
  Add PostgreSQL database
  Set environment variables
  Deploy

You'll get: https://your-backend.onrender.com

Step 3: Deploy Frontend to Netlify

Method 1: Netlify Dashboard (Easiest)
  Sign up/Login at netlify.com
  Add New Site â†’ Import from Git
  Connect to GitHub and select your repository
  Build Settings:
  - Base directory: client
  - Build command: npm run build
  - Publish directory: client/dist
  Environment Variables:
   Click "Show advanced" â†’ "New variable"
      VITEAPIURL = https://your-backend.railway.app
      (Update with your actual backend URL)
  Deploy site!

Method 2: Netlify CLI
  Install Netlify CLI:
      npm install -g netlify-cli
  Login:
      netlify login
  Initialize (in project root):
      cd client
   netlify init
  - Choose "Create & configure a new site"
  - Site name: (choose a name)
  - Build command: npm run build
  - Publish directory: dist
  Set environment variable:
      netlify env:set VITEAPIURL https://your-backend.railway.app
  Deploy:
      netlify deploy --prod
   

Step 4: Update netlify.toml

After deploying backend, update client/netlify.toml:

[[redirects]]
  from = "/api/*"
  to = "https://your-actual-backend.railway.app/api/:splat"
  status = 200
  force = true

Replace your-actual-backend.railway.app with your real backend URL.

Step 5: Configure CORS on Backend

Update your backend server/src/server.js to allow Netlify domain:

const ORIGIN = process.env.ORIGIN || 'http://localhost:5173';

app.use(cors({ 
  origin: [
    ORIGIN,
    'https://your-app.netlify.app',  // Add your Netlify URL
    /\.netlify\.app$/  // Allow all Netlify previews
  ],
  credentials: true
}));

Or use environment variable:
ORIGIN=https://your-app.netlify.app

Step 6: Deploy Python Flask API

Deploy to Railway or Render (same as backend):
  Railway: Add another service â†’ Select pythonprocessing directory
  Set start command: gunicorn -w 4 -b 0.0.0.0:$PORT flaskapi:app
  Environment variables: Same as backend (AWS S3 credentials)

Environment Variables Summary

Netlify (Frontend)
VITEAPIURL=https://your-backend.railway.app

Railway/Render (Backend)
PORT=5050
ORIGIN=https://your-app.netlify.app
NODEENV=production
AWSACCESSKEYID=your-key
AWSSECRETACCESSKEY=your-secret
AWSREGION=us-east-1
S3BUCKETNAME=your-bucket
DBHOST=your-db-host
DBPORT=5432
DBNAME=droneanalytics
DBUSER=postgres
DBPASSWORD=your-password

Railway/Render (Python API)
FLASKPORT=5001
AWSACCESSKEYID=your-key
AWSSECRETACCESSKEY=your-secret
AWSREGION=us-east-1
S3BUCKETNAME=your-bucket

Testing Deployment
  Visit your Netlify site: https://your-app.netlify.app
  Check browser console for errors
  Test image upload
  Test map functionality
  Verify API calls in Network tab

Custom Domain (Optional)
  In Netlify dashboard â†’ Domain settings
  Click Add custom domain
  Enter your domain
  Follow DNS configuration instructions
  Netlify provides free SSL automatically

Continuous Deployment

Netlify automatically deploys when you push to GitHub:
  - Production: Deploys from main branch
  - Preview: Creates preview for pull requests
  - Branch deploys: Deploy from any branch

Troubleshooting

CORS Errors
  - Check ORIGIN in backend environment variables
  - Verify Netlify URL is allowed in CORS config

API Not Found (404)
  - Check VITEAPIURL in Netlify environment variables
  - Verify backend is running and accessible
  - Check netlify.toml redirects

Build Fails
  - Check build logs in Netlify dashboard
  - Verify Node.js version (Netlify uses Node 18 by default)
  - Check for missing dependencies

Images Not Loading
  - Verify S3 bucket permissions
  - Check if images are uploaded to S3
  - Verify S3 URLs in API responses

Cost
  - Netlify: Free tier (100GB bandwidth, 300 build minutes/month)
  - Railway: $5/month (includes database)
  - S3: Pay per use (~$0.023/GB/month)

Total: ~$5-10/month

Next Steps
  âœ… Deploy backend to Railway/Render
  âœ… Deploy frontend to Netlify
  âœ… Set environment variables
  âœ… Test all functionality
  âœ… Set up custom domain (optional)
  âœ… Configure monitoring

Your app will be live at: https://your-app.netlify.app ðŸŽ‰