üöÄ Backend Deployment Instructions

Status
‚úÖ Changes committed and pushed to GitHub
  - CORS fixes for Netlify domains
  - HTTPS redirects in netlify.toml
  - Improved API error handling

Quick Deploy to EC2

Option 1: EC2 Instance Connect (Recommended - No SSH Keys Needed)
  Open AWS Console
  - Go to: https://console.aws.amazon.com/ec2/
  - Navigate to EC2 ‚Üí Instances
  - Find instance: ec2-18-117-90-212 (or search for "CropView")
  Connect via Instance Connect
  - Select the instance
  - Click "Connect" button
  - Choose "EC2 Instance Connect" tab
  - Click "Connect" (opens browser terminal)
  Run Deployment Commands
      cd ~/CapstoneInterface
   git pull origin main
   chmod +x deploy/update-backend-cors-remote.sh
   bash deploy/update-backend-cors-remote.sh
  Verify Deployment
      pm2 status
   pm2 logs --lines 20
   curl http://localhost:5050/api/health
   
Option 2: Manual Deployment (If Script Fails)

If the automated script doesn't work, run these commands manually:

cd ~/CapstoneInterface

Pull latest code
git pull origin main

Update Node.js dependencies
cd server
npm install --production
cd ..

Restart PM2 services
pm2 restart all
pm2 save

Verify
pm2 status
pm2 logs --lines 50

What Gets Deployed

Backend Changes:
  - ‚úÖ server/src/server-enhanced.js - CORS now allows all Netlify domains
  - ‚úÖ server/src/server.js - CORS now allows all Netlify domains
  - ‚úÖ Automatic Netlify domain detection (no manual configuration needed)

Frontend Changes:
  - ‚úÖ netlify.toml - HTTPS redirects (already pushed, will deploy via Netlify)
  - ‚úÖ client/src/utils/api.js - Improved error handling

Verification Steps

After deployment, verify everything works:
  Check PM2 Status
      pm2 status
      Should show all services running (green)
  Test Health Endpoint
      curl http://localhost:5050/api/health
      Should return JSON with status: "ok"
  Test CORS (from EC2)
      curl -H "Origin: https://your-site.netlify.app" \
        -H "Access-Control-Request-Method: GET" \
        -X OPTIONS \
        http://localhost:5050/api/health
      Should return CORS headers
  Test from External
      curl http://ec2-18-117-90-212.us-east-2.compute.amazonaws.com/api/health
      Should return JSON response
  Check Logs
      pm2 logs --lines 50
      Should not show CORS errors

Expected Results

After successful deployment:

‚úÖ Backend accepts requests from all *.netlify.app domains
‚úÖ No more "Failed to fetch" errors in frontend
‚úÖ CORS headers are properly set
‚úÖ API endpoints respond correctly

Troubleshooting

If git pull fails:
git status
git stash  # Save local changes
git pull origin main

If PM2 restart fails:
pm2 delete all
cd server
pm2 start ecosystem.config.cjs  # or ecosystem.config.js
pm2 save

If backend doesn't respond:
Check if port is in use
sudo netstat -tlnp | grep 5050

Check .env file
cd server
cat .env

Check logs
pm2 logs --lines 100

Next Steps
  ‚úÖ Deploy backend (follow instructions above)
  ‚è≥ Netlify will auto-deploy frontend changes (already pushed)
  ‚úÖ Test the application
  ‚úÖ Monitor for any errors

Support Files
  - Detailed deployment guide: deploy/DEPLOYCORSFIX.md
  - CORS fix documentation: documentation/deployment/FIXFETCHERROR.md
  - Troubleshooting: documentation/deployment/NETLIFY_TROUBLESHOOTING.md

Ready to deploy? Follow Option 1 above using EC2 Instance Connect! üöÄ